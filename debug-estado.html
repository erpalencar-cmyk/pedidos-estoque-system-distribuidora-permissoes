<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Estado do Supabase</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üîç Debug: Estado do Supabase</h1>
        
        <div id="status" class="p-4 rounded-lg bg-blue-900 border border-blue-700 mb-6">
            <p>‚è≥ Carregando...</p>
        </div>

        <pre id="debug" class="p-4 bg-gray-800 rounded text-green-400 font-mono text-sm overflow-auto max-h-96 border border-gray-700"></pre>

        <div class="mt-6 space-y-2">
            <button onclick="verificarStatus()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                üîÑ Verificar Agora
            </button>
            <button onclick="irParaProdutos()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                ‚ûú Ir para Produtos
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>

    <script>
        const debugDiv = document.getElementById('debug');
        const statusDiv = document.getElementById('status');

        function log(msg) {
            debugDiv.textContent += msg + '\n';
            console.log(msg);
        }

        async function verificarStatus() {
            debugDiv.textContent = '';
            statusDiv.innerHTML = '<p>‚è≥ Verificando...</p>';

            log('=== VERIFICA√á√ÉO DO ESTADO SUPABASE ===\n');
            
            // Aguardar um pouco para config.js processar
            await new Promise(r => setTimeout(r, 500));

            // Verifica√ß√µes b√°sicas
            log(`‚úì supabaseLib: ${!!supabaseLib}`);
            log(`‚úì supabaseCentral: ${!!supabaseCentral}`);
            log(`‚úì CURRENT_SUPABASE: ${!!CURRENT_SUPABASE}`);
            log(`‚úì CURRENT_EMPRESA: ${!!CURRENT_EMPRESA}`);
            log(`‚úì window.supabase: ${!!window.supabase}`);
            log(`‚úì window.supabase.from: ${typeof window.supabase?.from}\n`);

            if (CURRENT_EMPRESA) {
                log(`üè¢ Empresa em Mem√≥ria: ${CURRENT_EMPRESA.nome}`);
                log(`üÜî ID: ${CURRENT_EMPRESA.id}`);
                log(`üîó URL: ${CURRENT_EMPRESA.supabase_url}\n`);
            } else {
                log('‚ö†Ô∏è Nenhuma empresa em mem√≥ria\n');
            }

            // Testar window.supabase.from()
            try {
                if (!window.supabase?.from || typeof window.supabase.from !== 'function') {
                    throw new Error('window.supabase.from n√£o √© uma fun√ß√£o');
                }
                
                log('üß™ Testando window.supabase.from()');
                log('‚úÖ SUCESSO! window.supabase.from() est√° funcionando\n');
                
                statusDiv.innerHTML = '<p class="text-green-300">‚úÖ Sistema Pronto - window.supabase.from() funciona</p>';
                return;
            } catch (e) {
                log(`‚ùå ERRO: ${e.message}\n`);
                
                if (supabaseCentral?.from) {
                    log('‚ÑπÔ∏è supabaseCentral.from() funciona');
                    log('   Mas window.supabase.from() n√£o');
                    log('   ‚Üí Empresa n√£o foi restaurada do localStorage\n');
                    
                    statusDiv.innerHTML = '<p class="text-yellow-300">‚ö†Ô∏è Empresa n√£o carregada - Fa√ßa login primeiro</p>';
                } else {
                    statusDiv.innerHTML = '<p class="text-red-300">‚ùå Erro ao inicializar</p>';
                }
            }
        }

        async function irParaProdutos() {
            await verificarStatus();
            if (window.supabase?.from) {
                setTimeout(() => {
                    window.location.href = 'pages/produtos.html';
                }, 1000);
            } else {
                alert('‚ùå window.supabase.from n√£o est√° funcionando. Verifique o console.');
            }
        }

        // Verificar automaticamente ao carregar
        window.addEventListener('load', () => {
            setTimeout(verificarStatus, 500);
        });
    </script>
</body>
</html>
