<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes - Sistema Distribuidora</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        .modal-backdrop.hidden {
            display: none;
        }
        .btn-action {
            transition: all 0.2s ease;
        }
        .btn-action:hover {
            transform: scale(1.05);
        }
        .table-row-hover:hover {
            background-color: #f3f4f6;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="navbar"></div>
    <div id="sidebar-container"></div>

    <main class="lg:ml-64 pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-4xl font-bold text-gray-900 flex items-center">
                            <i class="fas fa-users mr-4 text-indigo-600"></i>Clientes
                        </h1>
                        <p class="text-gray-600 mt-2">Gerenciamento completo de clientes</p>
                    </div>
                    <button onclick="openModalCliente()" class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white px-6 py-3 rounded-lg hover:shadow-lg transition flex items-center gap-2">
                        <i class="fas fa-plus"></i> Novo Cliente
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-search mr-2"></i>Buscar
                        </label>
                        <input type="text" id="search" placeholder="Nome, CPF/CNPJ, cidade..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onkeyup="filterClientes()">
                    </div>
                    <div class="flex items-end">
                        <button onclick="loadClientes()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition flex items-center justify-center gap-2">
                            <i class="fas fa-redo"></i> Atualizar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tabela -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-100 to-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">CPF/CNPJ</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Cidade/UF</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Contato</th>
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientes-tbody" class="divide-y divide-gray-200">
                            <tr><td colspan="6" class="px-6 py-8 text-center text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i>Carregando clientes...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Cliente -->
    <div id="modal-cliente" class="modal-backdrop hidden">
        <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center px-6 py-4 border-b bg-gradient-to-r from-indigo-600 to-indigo-700 sticky top-0 z-10">
                <h3 id="modal-title" class="text-xl font-bold text-white">Novo Cliente</h3>
                <button onclick="closeModal('modal-cliente')" class="text-indigo-100 hover:text-white transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <form id="form-cliente" class="px-6 py-4" onsubmit="saveCliente(event)">
                <input type="hidden" id="cliente-id">
                
                <!-- Abas de Formulário -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-8 overflow-x-auto">
                        <button type="button" class="tab-btn py-2 px-1 border-b-2 border-indigo-600 text-indigo-600 font-semibold text-sm whitespace-nowrap" data-tab="tab-basico">
                            <i class="fas fa-info-circle mr-2"></i>Dados Principais
                        </button>
                        <button type="button" class="tab-btn py-2 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 text-sm whitespace-nowrap" data-tab="tab-contato">
                            <i class="fas fa-phone mr-2"></i>Contatos
                        </button>
                        <button type="button" class="tab-btn py-2 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 text-sm whitespace-nowrap" data-tab="tab-endereco">
                            <i class="fas fa-map-marker-alt mr-2"></i>Endereço
                        </button>
                    </nav>
                </div>

                <!-- TAB: DADOS PRINCIPAIS -->
                <div id="tab-basico" class="tab-content space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Nome <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="cliente-nome" required 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                placeholder="Ex: João Silva ou Empresa XPTO Ltda">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                            <select id="cliente-tipo" onchange="updateDocumentLabel()" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="FISICA">Pessoa Física</option>
                                <option value="JURIDICA">Pessoa Jurídica</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" id="label-documento">CPF</label>
                            <input type="text" id="cliente-cpf-cnpj" placeholder="000.000.000-00" onblur="formatDocument()" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- TAB: CONTATOS -->
                <div id="tab-contato" class="tab-content hidden space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-envelope mr-1 text-gray-400"></i>Email
                            </label>
                            <input type="email" id="cliente-email" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" 
                                placeholder="cliente@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-phone mr-1 text-gray-400"></i>Telefone
                            </label>
                            <input type="text" id="cliente-contato" placeholder="(11) 1234-5678" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fab fa-whatsapp mr-1 text-green-500"></i>WhatsApp
                            </label>
                            <input type="text" id="cliente-whatsapp" placeholder="+55 (11) 99999-9999" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- TAB: ENDEREÇO -->
                <div id="tab-endereco" class="tab-content hidden space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CEP</label>
                            <input type="text" id="cliente-cep" placeholder="00000-000" maxlength="9" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
                            <select id="cliente-estado" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="">Selecione</option>
                            <option value="SP">SP</option>
                            <option value="RJ">RJ</option>
                            <option value="MG">MG</option>
                            <option value="RS">RS</option>
                            <option value="PR">PR</option>
                            <option value="SC">SC</option>
                            <option value="BA">BA</option>
                            <option value="PE">PE</option>
                            <option value="CE">CE</option>
                            <option value="PA">PA</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="ES">ES</option>
                            <option value="PB">PB</option>
                            <option value="RN">RN</option>
                            <option value="AL">AL</option>
                            <option value="MT">MT</option>
                            <option value="MS">MS</option>
                            <option value="DF">DF</option>
                            <option value="SE">SE</option>
                            <option value="RO">RO</option>
                            <option value="TO">TO</option>
                            <option value="AC">AC</option>
                            <option value="AM">AM</option>
                            <option value="RR">RR</option>
                            <option value="AP">AP</option>
                            <option value="PI">PI</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cidade</label>
                        <input type="text" id="cliente-cidade" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Endereço Completo</label>
                        <textarea id="cliente-endereco" rows="2" placeholder="Rua, número, complemento, bairro..." 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex justify-end space-x-3 pt-6 border-t sticky bottom-0 bg-white">
                    <button type="button" onclick="closeModal('modal-cliente')" 
                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit" 
                        class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white rounded-lg hover:shadow-lg font-medium transition">
                        <i class="fas fa-save mr-2"></i>Salvar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <div class="spinner mx-auto"></div>
            <p class="mt-4 text-gray-700 font-medium">Processando...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/config.js"></script>
    <script src="../js/session-manager.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/services/clientes.js"></script>
    <script src="../components/navbar.js"></script>
    <script src="../components/sidebar.js"></script>
    <script src="../components/modal.js"></script>

    <script>
        let clientesData = [];
        let editingId = null;

        // ========== INICIALIZAÇÃO ==========
        (async () => {
            try {
                await checkAuth();
                document.getElementById('navbar').innerHTML = createNavbar();
                document.getElementById('sidebar-container').innerHTML = createSidebar();
                await initNavbar();
                await initSidebar();
                await loadClientes();
            } catch (error) {
                console.error('Erro ao inicializar clientes:', error);
                document.getElementById('navbar').innerHTML = createNavbar();
                document.getElementById('sidebar-container').innerHTML = createSidebar();
            }
            
            // Configurar navegação por tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        })();

        // ========== FUNÇÕES DE TAB ==========
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-indigo-600', 'text-indigo-600', 'font-semibold', 'bg-red-100', 'text-red-700');
                btn.classList.add('border-transparent', 'text-gray-600');
                btn.style.animation = '';
            });
            document.getElementById(tabId)?.classList.remove('hidden');
            const activeBtn = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('border-transparent', 'text-gray-600');
                activeBtn.classList.add('border-indigo-600', 'text-indigo-600', 'font-semibold');
            }
        }

        // ========== VALIDAÇÃO E SAVE ==========
        async function saveCliente(event) {
            event.preventDefault();
            
            const id = document.getElementById('cliente-id').value;
            
            // Validação de campos obrigatórios
            const erros = [];
            const nome = document.getElementById('cliente-nome')?.value?.trim();
            if (!nome) erros.push({ campo: 'Nome', aba: 'Dados Principais' });
            
            if (erros.length > 0) {
                mostrarErrosValidacao(erros);
                return;
            }
            
            const clienteData = {
                nome: nome,
                tipo: document.getElementById('cliente-tipo').value,
                cpf_cnpj: document.getElementById('cliente-cpf-cnpj').value?.trim() || null,
                email: document.getElementById('cliente-email').value?.trim() || null,
                contato: document.getElementById('cliente-contato').value?.trim() || null,
                whatsapp: document.getElementById('cliente-whatsapp').value?.trim() || null,
                cep: document.getElementById('cliente-cep').value?.trim() || null,
                estado: document.getElementById('cliente-estado').value || null,
                cidade: document.getElementById('cliente-cidade').value?.trim() || null,
                endereco: document.getElementById('cliente-endereco').value?.trim() || null
            };

            try {
                showLoading(true);
                let result;
                if (id) {
                    result = await updateCliente(id, clienteData);
                    showToast('Cliente atualizado com sucesso!', 'success');
                } else {
                    result = await createCliente(clienteData);
                    showToast('Cliente cadastrado com sucesso!', 'success');
                }

                if (result) {
                    closeModal('modal-cliente');
                    await loadClientes();
                }
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
                showToast('Erro ao salvar cliente: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function mostrarErrosValidacao(erros) {
            const abasComErro = [...new Set(erros.map(e => e.aba))];
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full">
                    <div class="bg-red-600 text-white p-4 rounded-t-lg">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle"></i>
                            Campos Obrigatórios Não Preenchidos
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                <strong>Atenção:</strong> Preencha todos os campos obrigatórios marcados com *.
                            </p>
                        </div>
                        <p class="text-gray-700 font-semibold mb-3">Você precisa preencher:</p>
                        ${abasComErro.map(aba => `
                            <div class="mb-4 p-3 bg-gray-50 rounded-lg border-l-4 border-red-500">
                                <div class="font-bold text-red-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-folder-open"></i>Aba: ${aba}
                                </div>
                                <ul class="space-y-1 ml-6">
                                    ${erros.filter(e => e.aba === aba).map(err => `
                                        <li class="text-sm text-gray-700 flex items-start gap-2">
                                            <i class="fas fa-chevron-right text-red-500 mt-1"></i>
                                            <span>${err.campo}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                    <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end">
                        <button onclick="this.closest('.fixed').remove()"
                            class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium transition-colors">
                            <i class="fas fa-check mr-2"></i>Entendi, vou corrigir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.querySelectorAll('[data-tab]').forEach(btn => {
                const tabName = btn.getAttribute('data-tab');
                const abaConfig = {
                    'tab-basico': 'Dados Principais',
                    'tab-contato': 'Contatos',
                    'tab-endereco': 'Endereço'
                };
                if (abasComErro.includes(abaConfig[tabName])) {
                    btn.classList.add('bg-red-100', 'text-red-700', 'font-bold');
                    btn.style.animation = 'pulse 2s infinite';
                }
            });
            
            const primeiraAbaErro = erros[0].aba;
            const mapAba = {'Dados Principais': 'tab-basico', 'Contatos': 'tab-contato', 'Endereço': 'tab-endereco'};
            const btnAba = document.querySelector(`[data-tab="${mapAba[primeiraAbaErro]}"]`);
            if (btnAba) btnAba.click();
        }

        // ========== LOAD E RENDER ==========
        async function loadClientes() {
            try {
                showLoading(true);
                clientesData = await getClientes();
                renderClientes(clientesData);
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                showToast('Erro ao carregar clientes', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderClientes(clientes) {
            const tbody = document.getElementById('clientes-tbody');
            
            if (clientes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Nenhum cliente encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = clientes.map(cliente => {
                const tipoBadge = cliente.tipo === 'PJ' || cliente.tipo === 'JURIDICA'
                    ? '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">PJ</span>'
                    : '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">PF</span>';
                
                const cidadeUf = [cliente.cidade, cliente.estado].filter(Boolean).join(' - ') || '-';
                const contato = cliente.contato || cliente.whatsapp || '-';
                
                return `
                    <tr class="table-row-hover">
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${escapeHtml(cliente.nome)}</div>
                            ${cliente.email ? `<div class="text-sm text-gray-500">${escapeHtml(cliente.email)}</div>` : ''}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700">
                            ${cliente.cpf_cnpj || '-'}
                        </td>
                        <td class="px-6 py-4">
                            ${tipoBadge}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700">
                            ${cidadeUf}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700">
                            ${contato}
                        </td>
                        <td class="px-6 py-4 text-right space-x-2">
                            <button onclick='editCliente(${JSON.stringify(cliente)})' 
                                class="btn-action bg-blue-500 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="confirmDelete('${cliente.id}')" 
                                class="btn-action bg-red-500 hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filtrar clientes
        function filterClientes() {
            const search = document.getElementById('search').value.toLowerCase();
            const filtered = clientesData.filter(c => 
                c.nome.toLowerCase().includes(search) ||
                (c.cpf_cnpj && c.cpf_cnpj.toLowerCase().includes(search))
            );
            renderClientes(filtered);
        }

        // ========== MODAL E EDIÇÃO ==========
        function openModalCliente() {
            document.getElementById('modal-title').textContent = 'Novo Cliente';
            document.getElementById('form-cliente').reset();
            document.getElementById('cliente-id').value = '';
            document.getElementById('cliente-tipo').value = 'PF';
            updateDocumentLabel();
            switchTab('tab-basico'); // Sempre abre na primeira aba
            openModal('modal-cliente');
        }

        function editCliente(cliente) {
            document.getElementById('modal-title').textContent = 'Editar Cliente';
            document.getElementById('cliente-id').value = cliente.id;
            document.getElementById('cliente-nome').value = cliente.nome || '';
            document.getElementById('cliente-tipo').value = cliente.tipo || 'PF';
            document.getElementById('cliente-cpf-cnpj').value = cliente.cpf_cnpj || '';
            document.getElementById('cliente-email').value = cliente.email || '';
            document.getElementById('cliente-contato').value = cliente.contato || '';
            document.getElementById('cliente-whatsapp').value = cliente.whatsapp || '';
            document.getElementById('cliente-cep').value = cliente.cep || '';
            document.getElementById('cliente-estado').value = cliente.estado || '';
            document.getElementById('cliente-cidade').value = cliente.cidade || '';
            document.getElementById('cliente-endereco').value = cliente.endereco || '';
            updateDocumentLabel();
            switchTab('tab-basico'); // Sempre abre na primeira aba
            openModal('modal-cliente');
        }

        // ========== UTILITÁRIOS ==========
        function updateDocumentLabel() {
            const tipo = document.getElementById('cliente-tipo').value;
            const label = document.getElementById('label-documento');
            const input = document.getElementById('cliente-cpf-cnpj');
            
            if (tipo === 'PF' || tipo === 'FISICA') {
                label.textContent = 'CPF';
                input.placeholder = '000.000.000-00';
            } else {
                label.textContent = 'CNPJ';
                input.placeholder = '00.000.000/0000-00';
            }
        }

        function formatDocument() {
            const tipo = document.getElementById('cliente-tipo').value;
            const input = document.getElementById('cliente-cpf-cnpj');
            const value = input.value;
            
            if (!value) return;
            
            if (tipo === 'PF' || tipo === 'FISICA') {
                input.value = formatarCPF(value);
            } else {
                input.value = formatarCNPJ(value);
            }
        }

        function filterClientes() {
            const search = document.getElementById('search').value.toLowerCase();
            const filtered = clientesData.filter(c => 
                c.nome.toLowerCase().includes(search) ||
                (c.cpf_cnpj && c.cpf_cnpj.toLowerCase().includes(search)) ||
                (c.email && c.email.toLowerCase().includes(search))
            );
            renderClientes(filtered);
        }

        async function confirmDelete(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                try {
                    showLoading(true);
                    const success = await deleteCliente(id);
                    if (success) {
                        showToast('Cliente excluído com sucesso!', 'success');
                        await loadClientes();
                    }
                } catch (error) {
                    console.error('Erro ao excluir cliente:', error);
                    showToast('Erro ao excluir cliente', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
    </script>
</body>
</html>
