<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Supabase Init</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">üîç Status Supabase</h1>
        
        <div id="status" class="p-4 rounded-lg bg-blue-50 border border-blue-200 mb-6">
            <p class="text-blue-800">‚è≥ Carregando...</p>
        </div>

        <pre id="debug" class="p-4 bg-gray-900 text-green-400 rounded-lg text-sm overflow-auto max-h-96 font-mono"></pre>

        <div class="mt-6 space-y-2">
            <button 
                onclick="verificarStatus()" 
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
            >
                üîÑ Verificar Status
            </button>
            <button 
                onclick="irParaDashboard()" 
                class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition"
            >
                ‚ûú Ir para Dashboard
            </button>
        </div>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        const debugDiv = document.getElementById('debug');

        function log(msg) {
            debugDiv.textContent += msg + '\n';
            console.log(msg);
        }

        async function verificarStatus() {
            debugDiv.textContent = '';
            statusDiv.className = 'p-4 rounded-lg bg-blue-50 border border-blue-200 mb-6';
            statusDiv.innerHTML = '<p class="text-blue-800">‚è≥ Verificando...</p>';

            log('=== VERIFICA√á√ÉO SUPABASE ===\n');
            
            // Aguardar config.js estar pronto
            await new Promise(resolve => setTimeout(resolve, 300));

            // Verificar biblioteca
            log(`‚úì Biblioteca Supabase (supabaseLib): ${!!supabaseLib}`);
            log(`‚úì Cliente Central (supabaseCentral): ${!!supabaseCentral}`);
            log(`‚úì Cliente Empresa (CURRENT_SUPABASE): ${!!CURRENT_SUPABASE}`);
            log(`‚úì window.supabase: ${!!window.supabase}\n`);

            if (CURRENT_EMPRESA) {
                log(`üè¢ Empresa Carregada: ${CURRENT_EMPRESA.nome}`);
                log('‚úÖ Cliente da empresa est√° ATIVO\n');
            } else {
                log('‚ÑπÔ∏è Nenhuma empresa carregada');
                log('   (Esperado se n√£o fez login ainda)\n');
            }

            // Testar m√©todo .from()
            try {
                if (!window.supabase?.from) {
                    throw new Error('window.supabase.from n√£o √© uma fun√ß√£o');
                }
                
                log('üß™ Testando window.supabase.from()');
                log('‚úÖ SUCESSO: window.supabase.from() est√° funcionando!\n');
                
                statusDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200 mb-6';
                statusDiv.innerHTML = '<p class="text-green-800">‚úÖ Cliente Supabase PRONTO</p>';
                
            } catch (e) {
                log(`‚ùå ERRO: ${e.message}\n`);
                
                if (supabaseCentral?.from) {
                    log('‚ÑπÔ∏è Banco central est√° funcionando');
                    log('   Carregue empresa para ativar cliente espec√≠fico\n');
                    
                    statusDiv.className = 'p-4 rounded-lg bg-yellow-50 border border-yellow-200 mb-6';
                    statusDiv.innerHTML = '<p class="text-yellow-800">‚ö†Ô∏è Banco central OK, fa√ßa login</p>';
                } else {
                    statusDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200 mb-6';
                    statusDiv.innerHTML = '<p class="text-red-800">‚ùå Erro ao inicializar</p>';
                }
            }
        }

        async function irParaDashboard() {
            await verificarStatus();
            if (window.supabase?.from) {
                setTimeout(() => {
                    window.location.href = 'pages/dashboard.html';
                }, 1000);
            } else {
                alert('‚ö†Ô∏è Cliente n√£o est√° pronto. Fa√ßa login primeiro em http://localhost:8000/index.html');
            }
        }

        // Verificar automaticamente ao carregar
        window.addEventListener('load', () => {
            log('üìÑ P√°gina carregada\n');
            setTimeout(verificarStatus, 500);
        });
    </script>
</body>
</html>
